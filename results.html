<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700%7CRoboto:400,700" rel="stylesheet">
    <link href='style.css' rel='stylesheet' type='text/css'>
    <title>MarxistValues 1.0 Results</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="shortcut icon" type="image/png" href="icon.png">
    <meta charset="utf-8">
    <script type="application/javascript" src="ideologies.js">
    </script>
</head>

<body>

    <h1 data-i18n="result_h1">MarxistValues 1.0</h1>
    <h1 data-i18n="result_h1">Results</h1>

    <h2><span class="weight-300" id="a-label"></span></h2>
    <div class="axis">
        <img id="img-revolution" src="value_images/revolution.png" height="128pt" />
        <div class="bar revolution" id="bar-revolution">
            <div class="text-wrapper" id="revolution"></div>
        </div>
        <div class="bar reform" id="bar-reform">
            <div class="text-wrapper" id="reform"></div>
        </div>
        <img id="img-reform" src="value_images/reform.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="b-label"></span></h2>
    <div class="axis">
        <img id="img-voluntarism" src="value_images/voluntarism.png" height="128pt" />
        <div class="bar voluntarism" id="bar-voluntarism">
            <div class="text-wrapper" id="voluntarism"></div>
        </div>
        <div class="bar economism" id="bar-economism">
            <div class="text-wrapper" id="economism"></div>
        </div>
        <img id="img-economism" src="value_images/economism.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="c-label"></span></h2>
    <div class="axis">
        <img id="img-central" src="value_images/central.png" height="128pt" />
        <div class="bar central" id="bar-central">
            <div class="text-wrapper" id="central"></div>
        </div>
        <div class="bar decentral" id="bar-decentral">
            <div class="text-wrapper" id="decentral"></div>
        </div>
        <img id="img-decentral" src="value_images/decentral.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="d-label"></span></h2>
    <div class="axis">
        <img id="img-international" src="value_images/international.png" height="128pt" />
        <div class="bar international" id="bar-international">
            <div class="text-wrapper" id="international"></div>
        </div>
        <div class="bar patriotic" id="bar-patriotic">
            <div class="text-wrapper" id="patriotic"></div>
        </div>
        <img id="img-patriotic" src="value_images/patriotic.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="e-label"></span></h2>
    <div class="axis">
        <img id="img-party" src="value_images/party.png" height="128pt" />
        <div class="bar party" id="bar-party">
            <div class="text-wrapper" id="party"></div>
        </div>
        <div class="bar union" id="bar-union">
            <div class="text-wrapper" id="union"></div>
        </div>
        <img id="img-union" src="value_images/union.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="f-label"></span></h2>
    <div class="axis">
        <img id="img-proletariat" src="value_images/proletariat.png" height="128pt" />
        <div class="bar proletariat" id="bar-proletariat">
            <div class="text-wrapper" id="proletariat"></div>
        </div>
        <div class="bar peasantry" id="bar-peasantry">
            <div class="text-wrapper" id="peasantry"></div>
        </div>
        <img id="img-peasantry" src="value_images/peasantry.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="g-label"></span></h2>
    <h2 data-i18n="result_h2_match">Closest Match:<span class="weight-300" id="ideology-label"></span></h2>
    <h3><span class="weight-300" id="ideodesc-label"></span></h3>
    <p data-i18n="result_url"><br>You can send these results by copying and pasting the URL at the top of the page or
        using the image below.</p>

    <h2 data-i18n="result_h2_next_matches">Next closest matches</h2>
    <p data-i18n="next_matches_percent">With your closest match as 100% and farthest as 0%, here is how closely you
        matched the other ideologies.</p>

    <dl id="next-matches"></dl>

    <canvas id="banner" width=800 height=1000 style="font-family:Montserrat"></canvas>
    <button data-i18n="result_back" class="button" onclick="location.href='index.html';"
        style="background-color: #2196f3;">Back</button> <br>
    <!-- Privacy respecting Statcounter code for MarxistValues http://marxistvalues.github.io -->
    <script type="text/javascript">
        var sc_project = 12079783;
        var sc_invisible = 1;
        var sc_security = "f3285a9d";
        var sc_https = 1;
        if (navigator.doNotTrack != 1) {
            var statcounterscript = document.createElement('script');
            statcounterscript.setAttribute("type", "text/javascript");
            statcounterscript.setAttribute("src", "https://www.statcounter.com/counter/counter.js");
            document.getElementsByTagName("body")[0].appendChild(statcounterscript);
        }
    </script>
    <!-- End of Statcounter Code -->
    <!-- JavaScript for the test itself -->
    <script type="application/javascript" src="i18n.js"></script>
    <script>
        /* global i18n, ideologies */
        function getQueryVariable (variable) {
        var query = window.location.search.substring(1)
        var vars = query.split('&')
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=')
            if (pair[0] === variable) {
            return pair[1]
            }
        }
        return (NaN)
        }

        function setBarValue (name, value) {
        const innerel = document.getElementById(name)
        const outerel = document.getElementById('bar-' + name)
        outerel.style.width = (value + '%')
        innerel.innerHTML = (value + '%')
        if (innerel.offsetWidth + 20 > outerel.offsetWidth) {
            innerel.style.visibility = 'hidden'
        }
        }

        function setLabel (val, ary) {
        ary = ary.split(',')
        if (val > 100) {
            return ''
        } else
        if (val > 90) {
            return ary[0]
        } else
        if (val > 75) {
            return ary[1]
        } else
        if (val > 60) {
            return ary[2]
        } else
        if (val >= 40) {
            return ary[3]
        } else
        if (val >= 25) {
            return ary[4]
        } else
        if (val >= 10) {
            return ary[5]
        } else
        if (val >= 0) {
            return ary[6]
        } else {
            return ''
        }
        }

        function getIdeologyNameByIndex (name) {
        return i18n.getString(`ideology_${name}_name`)
        }

        function getIdeologyDescriptionByIndex (name) {
        return i18n.getString(`ideology_${name}_desc`)
        }

        const revolution = getQueryVariable('a')
        const voluntarism = getQueryVariable('b')
        const central = getQueryVariable('c')
        const international = getQueryVariable('d')
        const party = getQueryVariable('e')
        const proletariat = getQueryVariable('f')
        const reform = (100 - revolution).toFixed(1)
        const economism = (100 - voluntarism).toFixed(1)
        const decentral = (100 - central).toFixed(1)
        const patriotic = (100 - international).toFixed(1)
        const union = (100 - party).toFixed(1)
        const peasantry = (100 - proletariat).toFixed(1)

        setBarValue('revolution', revolution)
        setBarValue('reform', reform)
        setBarValue('economism', economism)
        setBarValue('voluntarism', voluntarism)
        setBarValue('central', central)
        setBarValue('decentral', decentral)
        setBarValue('patriotic', patriotic)
        setBarValue('international', international)
        setBarValue('party', party)
        setBarValue('union', union)
        setBarValue('proletariat', proletariat)
        setBarValue('peasantry', peasantry)

        document.getElementById('a-label').innerHTML = setLabel(revolution, i18n.getString(
            'result_a_label'))
        document.getElementById('b-label').innerHTML = setLabel(voluntarism, i18n.getString(
            'result_b_label'))
        document.getElementById('c-label').innerHTML = setLabel(central, i18n.getString('result_c_label'))
        document.getElementById('d-label').innerHTML = setLabel(international, i18n.getString(
            'result_d_label'))
        document.getElementById('e-label').innerHTML = setLabel(party, i18n.getString('result_e_label'))
        document.getElementById('f-label').innerHTML = setLabel(proletariat, i18n.getString('result_f_label'))

        let ideology = ''
        let ideodesc = ''
        const ideologyIndexAndDistance = []
        var closestMatch = {}

        let index = 0
        for (const name of Object.keys(ideologies)) {
            let dist = 0
            dist += Math.pow(Math.abs(ideologies[name].a - revolution), 2)
            dist += Math.pow(Math.abs(ideologies[name].c - central), 2)
            dist += Math.pow(Math.abs(ideologies[name].b - voluntarism), 2)
            dist += Math.pow(Math.abs(ideologies[name].d - international), 2)
            dist += Math.pow(Math.abs(ideologies[name].e - party), 2)
            dist += Math.pow(Math.abs(ideologies[name].f - proletariat), 2)

            // ideologyToDistance[name] = dist
            ideologyIndexAndDistance.push({
            distance: dist,
            name,
            index
            })
            index++
        }

        ideologyIndexAndDistance.sort(function (a, b) {
            return a.distance - b.distance
        })

        const distances = ideologyIndexAndDistance.map(function (indexAndDistance) {
            return indexAndDistance.distance
        })

        const closestDistance = distances[0]
        const farthestDistance = distances[distances.length - 1]
        const distanceSpan = farthestDistance - closestDistance

        closestMatch = ideologyIndexAndDistance[0]
        document.getElementById('ideology-label').innerHTML = getIdeologyNameByIndex(closestMatch.name)
        document.getElementById('ideodesc-label').innerHTML = getIdeologyDescriptionByIndex(closestMatch
            .name)

        const nextMatches = document.getElementById('next-matches')
        nextMatches.innerHTML = ideologyIndexAndDistance.slice(1).map(function (indexAndDistance) {
            const name = indexAndDistance.name
            ideology = getIdeologyNameByIndex(name)
            ideodesc = getIdeologyDescriptionByIndex(name)
            const relativeDistance = 1 - (indexAndDistance.distance - closestDistance) /
                            distanceSpan
            const relativeDistancePercent = Math.round(relativeDistance * 1000) / 10
            return '<dt>' + ideology + ': ' + relativeDistancePercent + '%</dt>' +
                            '<dd>' + ideodesc + '</dd>'
        }).join('\n')

        const c = document.getElementById('banner')
        const ctx = c.getContext('2d')
        ctx.fillStyle = '#EEEEEE'
        ctx.fillRect(0, 0, 800, 1000)

        let img = document.getElementById('img-revolution')
        ctx.drawImage(img, 20, 170, 100, 100)
        img = document.getElementById('img-reform')
        ctx.drawImage(img, 680, 170, 100, 100)
        img = document.getElementById('img-voluntarism')
        ctx.drawImage(img, 20, 290, 100, 100)
        img = document.getElementById('img-economism')
        ctx.drawImage(img, 680, 290, 100, 100)
        img = document.getElementById('img-central')
        ctx.drawImage(img, 20, 410, 100, 100)
        img = document.getElementById('img-decentral')
        ctx.drawImage(img, 680, 410, 100, 100)
        img = document.getElementById('img-international')
        ctx.drawImage(img, 20, 530, 100, 100)
        img = document.getElementById('img-patriotic')
        ctx.drawImage(img, 680, 530, 100, 100)
        img = document.getElementById('img-party')
        ctx.drawImage(img, 20, 650, 100, 100)
        img = document.getElementById('img-union')
        ctx.drawImage(img, 680, 650, 100, 100)
        img = document.getElementById('img-proletariat')
        ctx.drawImage(img, 20, 770, 100, 100)
        img = document.getElementById('img-peasantry')
        ctx.drawImage(img, 680, 770, 100, 100)

        ctx.fillStyle = '#222222'
        ctx.fillRect(120, 180, 560, 80)
        ctx.fillRect(120, 300, 560, 80)
        ctx.fillRect(120, 420, 560, 80)
        ctx.fillRect(120, 540, 560, 80)
        ctx.fillRect(120, 660, 560, 80)
        ctx.fillRect(120, 780, 560, 80)
        ctx.fillRect(120, 900, 560, 80)
        ctx.fillStyle = '#890000'
        ctx.fillRect(120, 184, 5.6 * revolution - 2, 72)
        ctx.fillStyle = '#FC5959'
        ctx.fillRect(682 - 5.6 * reform, 184, 5.6 * reform - 2, 72)
        ctx.fillStyle = '#88232B'
        ctx.fillRect(120, 304, 5.6 * voluntarism - 2, 72)
        ctx.fillStyle = '#7F0037'
        ctx.fillRect(682 - 5.6 * economism, 304, 5.6 * economism - 2, 72)
        ctx.fillStyle = '#560000'
        ctx.fillRect(120, 424, 5.6 * central - 2, 72)
        ctx.fillStyle = '#000000'
        ctx.fillRect(682 - 5.6 * decentral, 424, 5.6 * decentral - 2, 72)
        ctx.fillStyle = '#782F52'
        ctx.fillRect(120, 544, 5.6 * international - 2, 72)
        ctx.fillStyle = '#7F3300'
        ctx.fillRect(682 - 5.6 * patriotic, 544, 5.6 * patriotic - 2, 72)
        ctx.fillStyle = '#963B33'
        ctx.fillRect(120, 664, 5.6 * party - 2, 72)
        ctx.fillStyle = '#7F333B'
        ctx.fillRect(682 - 5.6 * union, 664, 5.6 * union - 2, 72)
        ctx.fillStyle = '#804E00'
        ctx.fillRect(120, 784, 5.6 * proletariat - 2, 72)
        ctx.fillStyle = '#76890B'
        ctx.fillRect(682 - 5.6 * peasantry, 784, 5.6 * peasantry - 2, 72)
        ctx.fillStyle = '#27577A'
        ctx.font = '700 80px Montserrat'
        ctx.textAlign = 'left'
        ctx.fillText('MarxistValues 1.0', 20, 90)
        ctx.font = '50px Montserrat'
        ctx.fillText(getIdeologyNameByIndex(closestMatch.name), 20, 140)

        ctx.fillStyle = '#dddddd'
        ctx.textAlign = 'left'
        if (revolution > 30) {
            ctx.fillText(revolution + '%', 130, 237.5)
        }
        if (voluntarism > 30) {
            ctx.fillText(voluntarism + '%', 130, 357.5)
        }
        if (central > 30) {
            ctx.fillText(central + '%', 130, 477.5)
        }
        if (international > 30) {
            ctx.fillText(international + '%', 130, 597.5)
        }
        if (party > 30) {
            ctx.fillText(party + '%', 130, 717.5)
        }
        if (proletariat > 30) {
            ctx.fillText(proletariat + '%', 130, 837.5)
        }
        ctx.textAlign = 'right'
        if (reform > 30) {
            ctx.fillText(reform + '%', 670, 237.5)
        }
        if (economism > 30) {
            ctx.fillText(economism + '%', 670, 357.5)
        }
        if (decentral > 30) {
            ctx.fillText(decentral + '%', 670, 477.5)
        }
        if (patriotic > 30) {
             ctx.fillText(patriotic + '%', 670, 597.5)
        }
        if (union > 30) {
            ctx.fillText(union + '%', 670, 717.5)
        }
        if (peasantry > 30) {
            ctx.fillText(peasantry + '%', 670, 837.5)
        }

        ctx.fillStyle = '#222222'
        ctx.font = '300 30px Montserrat'
        ctx.fillText('marxistvalues.github.io', 780, 60)
        ctx.textAlign = 'center'
        ctx.fillText('' + document.getElementById('a-label').innerHTML, 400, 175)
        ctx.fillText('' + document.getElementById('b-label').innerHTML, 400, 295)
        ctx.fillText('' + document.getElementById('c-label').innerHTML, 400, 415)
        ctx.fillText('' + document.getElementById('d-label').innerHTML, 400, 535)
        ctx.fillText('' + document.getElementById('e-label').innerHTML, 400, 655)
        ctx.fillText('' + document.getElementById('f-label').innerHTML, 400, 775)
        ctx.fillText('' + document.getElementById('g-label').innerHTML, 400, 895)
    </script>
</body>

</html>
